<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Level conditional forecast reconciliation for genuine hierarchical/grouped time series — levrec • FoReco</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Level conditional forecast reconciliation for genuine hierarchical/grouped time series — levrec" />
<meta property="og:description" content="

Forecast reconciliation procedure based on and extending the original
proposal by Hollyman et al. (2021). Unbiased top-down and level conditional
reconciled forecasts may be computed in cross-sectional, temporal, and
cross-temporal frameworks. The reconciled forecasts are conditional to (i.e.,
constrained by) the base forecasts of the upper levels of the hierarchy
(exogenous constraints). The linear constraints linking the variables may be
dealt with endogenously as well, according to Di Fonzo (2021).
Combined Conditional Coherent (CCC, Hollyman et al., 2021)
forecasts may be calculated as simple averages of different middle-out level
reconciled forecasts, with both endogenous and exogenous constraints." />
<meta property="og:image" content="https://danigiro.github.io/FoReco/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FoReco</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/FoReco_package.html">Using the FoReco package</a>
    </li>
    <li>
      <a href="../articles/accuracy_indices.html">Average relative accuracy indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="far fa far fa-newspaper"></span>
     
    News
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/daniGiro/FoReco">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/FoReco/index.html">
    <span class="fab fa fab fa-r-project fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Level conditional forecast reconciliation for genuine hierarchical/grouped time series</h1>
    <small class="dont-index">Source: <a href='https://github.com/daniGiro/FoReco/blob/master/R/levrec.R'><code>R/levrec.R</code></a></small>
    <div class="hidden name"><code>levrec.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

Forecast reconciliation procedure based on and extending the original
proposal by Hollyman et al. (2021). Unbiased top-down and level conditional
reconciled forecasts may be computed in cross-sectional, temporal, and
cross-temporal frameworks. The reconciled forecasts are conditional to (i.e.,
constrained by) the base forecasts of the upper levels of the hierarchy
(exogenous constraints). The linear constraints linking the variables may be
dealt with endogenously as well, according to Di Fonzo (2021).
<em>Combined Conditional Coherent</em> (CCC, Hollyman et al., 2021)
forecasts may be calculated as simple averages of different middle-out level
reconciled forecasts, with both endogenous and exogenous constraints.</p>
    </div>

    <pre class="usage"><span class='fu'>levrec</span><span class='op'>(</span>
  <span class='va'>basef</span>,
  <span class='va'>C</span>,
  <span class='va'>nk</span>,
  <span class='va'>m</span>,
  <span class='va'>weights</span>,
  bmeans <span class='op'>=</span> <span class='cn'>NULL</span>,
  const <span class='op'>=</span> <span class='st'>"exogenous"</span>,
  CCC <span class='op'>=</span> <span class='cn'>TRUE</span>,
  nn <span class='op'>=</span> <span class='cn'>FALSE</span>,
  settings <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>basef</th>
      <td><p>(\(h \times n\)) matrix of base forecasts to be reconciled;
h is the forecast horizon and n is the total number of time series.</p></td>
    </tr>
    <tr>
      <th>C</th>
      <td><p>(\(n_a \times n_b\)) cross-sectional (contemporaneous) matrix
mapping the bottom level series into the higher level ones (or a list
of matrices forming \(\textbf{C} = [\textbf{C}_1' \; \textbf{C}_2' \; ... \; \textbf{C}_K']'\),
\(1, ..., K\) being the number of upper levels, only cross-sectional).</p></td>
    </tr>
    <tr>
      <th>nk</th>
      <td><p>(\(K \times 1\)) vector containing the number of time series
in each level of the hierarchy (<code>nk[1] = 1</code>).</p></td>
    </tr>
    <tr>
      <th>m</th>
      <td><p>Highest available sampling frequency per seasonal cycle (max. order
of temporal aggregation, \(m\)), or a subset of \(p\) factors
of \(m\).</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>covariance matrix or a vector</p></td>
    </tr>
    <tr>
      <th>bmeans</th>
      <td><p>(\(h \times n_b\)) matrix of bts means (prova)</p></td>
    </tr>
    <tr>
      <th>const</th>
      <td><p><strong>exo</strong>genous or <strong>endo</strong>genous constraints
(<em>default</em> is "exo")</p></td>
    </tr>
    <tr>
      <th>CCC</th>
      <td><p>Option to return Combined Conditional Coherent reconciled
forecasts (<em>default</em> is TRUE).</p></td>
    </tr>
    <tr>
      <th>nn</th>
      <td><p>Logical value: <code>TRUE</code> if non-negative reconciled forecasts
are wished.</p></td>
    </tr>
    <tr>
      <th>settings</th>
      <td><p>Settings for <span class="pkg">osqp</span> (object <code><a href='https://rdrr.io/pkg/osqp/man/osqpSettings.html'>osqpSettings</a></code>).
The default options are: <code>verbose = FALSE</code>, <code>eps_abs = 1e-5</code>,
<code>eps_rel = 1e-5</code>, <code>polish_refine_iter = 100</code> and <code>polish = TRUE</code>.
For details, see the <a href='https://osqp.org/'><span class="pkg">osqp</span> documentation</a>
(Stellato et al., 2019).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional functional arguments passed to <a href='htsrec.html'>htsrec</a> of
FoReco (type, nn, nn_type, bounds)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns the unbiased top-down reconciled forecasts
in case of an elementary hierarchy with one level.
Otherwise it returns a list with</p>
<dt><code>recf</code></dt><dd><p>the Unbiased Top-Down reconciled forecasts, if <code>CCC = FALSE</code>, or the CCC reconciled forecasts.</p></dd>
<dt><code>lev</code></dt><dd><p>list of level conditional reconciled forecasts (Unbiased Top-Down + Middle-Out + BU).</p></dd>
<dt><code>info</code> (<code>type="osqp"</code>)</dt><dd><p>matrix with some useful indicators (columns)
for each forecast horizon \(h\) (rows): run time (<code>run_time</code>), number of iteration,
norm of primal residual (<code>pri_res</code>), status of osqp's solution (<code>status</code>) and
polish's status (<code>status_polish</code>).</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Di Fonzo, T., Girolimetto, D. (2020), Cross-Temporal Forecast Reconciliation:
Optimal Combination Method and Heuristic Alternatives, Department of Statistical
Sciences, University of Padua, <a href='https://arxiv.org/abs/2006.08570'>arXiv:2006.08570</a>.</p>
<p>Di Fonzo, T. (2021), <em>Approfondimenti, interpretazione ed estensioni della procedura Unbiased Top-Down Forecast
Reconciliation di Hollyman et al. (2021)</em> (in Italian, mimeo).</p>
<p>Hollyman, R., Petropoulos, F., Tipping, M.E. (2021), Understanding Forecast Reconciliation,
<em>European Journal of Operational Research</em> (in press).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>FoReco_data</span><span class='op'>)</span>
<span class='co'># Cross sectional aggregation matrix</span>
<span class='va'>C</span> <span class='op'>&lt;-</span> <span class='va'>FoReco_data</span><span class='op'>$</span><span class='va'>C</span>
<span class='co'># monthly base forecasts</span>
<span class='va'>id</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>simplify2array</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>FoReco_data</span><span class='op'>$</span><span class='va'>base</span><span class='op'>)</span>, split <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span>, <span class='op'>]</span> <span class='op'>==</span> <span class='st'>"k1"</span><span class='op'>)</span>
<span class='va'>mbase</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>FoReco_data</span><span class='op'>$</span><span class='va'>base</span><span class='op'>[</span>, <span class='va'>id</span><span class='op'>]</span><span class='op'>)</span>
<span class='co'># residuals</span>
<span class='va'>id</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>simplify2array</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>FoReco_data</span><span class='op'>$</span><span class='va'>res</span><span class='op'>)</span>, split <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span>, <span class='op'>]</span> <span class='op'>==</span> <span class='st'>"k1"</span><span class='op'>)</span>
<span class='va'>mres</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>FoReco_data</span><span class='op'>$</span><span class='va'>res</span><span class='op'>[</span>, <span class='va'>id</span><span class='op'>]</span><span class='op'>)</span>
<span class='co'># covariance matrix of the bts base forecasts, computed using the in-sample residuals</span>
<span class='va'>Wres</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cov</a></span><span class='op'>(</span><span class='va'>mres</span><span class='op'>)</span>
<span class='co'># diagonal matrix containing the residual variances of the bts base forecasts</span>
<span class='va'>Wb</span> <span class='op'>&lt;-</span> <span class='va'>Wres</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span>,
           <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>

<span class='co'>## EXOGENOUS CONSTRAINTS AND DIAGONAL COVARIANCE MATRIX (Hollyman et al., 2021)</span>
<span class='co'># Unbiased Top-Down reconciliation for an elementary hierarchy:</span>
<span class='co'># 1 top-level series + nb bottom-level series (Level 2 base forecasts are not considered).</span>
<span class='co'># The input is given by the base forecasts of the top and bottom levels series,</span>
<span class='co'># along with a vector of positive weights for the bts base forecasts</span>
<span class='va'>exo_EHd</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>,<span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>, weights <span class='op'>=</span> <span class='va'>Wb</span><span class='op'>)</span>

<span class='co'># Level conditional reconciled forecasts</span>
<span class='co'># L1: Unbiased Top-Down reconciled forecasts for the whole hierarchy</span>
<span class='co'># L2: Middle-Out reconciled forecasts using Level 2 conditional reconciled forecasts</span>
<span class='co'># L3: Bottom-Up reconciled forecasts</span>
<span class='va'>exo_LCd</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Wb</span><span class='op'>)</span>, CCC <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># Combined Conditional Coherent (CCC) reconciled forecasts</span>
<span class='co'># recf: CCC reconciled forecasts matrix</span>
<span class='co'># L1: Unbiased Top-Down reconciled forecasts for the whole hierarchy</span>
<span class='co'># L2: Middle-Out reconciled forecasts using Level 2 conditional reconciled forecasts</span>
<span class='co'># L3: Bottom-Up reconciled forecasts</span>
<span class='va'>exo_CCCd</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Wb</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## EXOGENOUS CONSTRAINTS AND FULL COVARIANCE MATRIX</span>
<span class='co'># Simply substitute weights=diag(Wb) with weights=Wb</span>
<span class='co'># Warning: possible negative reconciled forecasts may appear.</span>
<span class='co'># This issue must be fixed in the next future.</span>
<span class='va'>exo_EHf</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>,<span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>, weights <span class='op'>=</span> <span class='va'>Wb</span><span class='op'>)</span>
<span class='va'>exo_LCf</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='va'>Wb</span>, CCC <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>exo_CCCf</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='va'>Wb</span><span class='op'>)</span>

<span class='co'>## ENDOGENOUS CONSTRAINTS AND DIAGONAL COVARIANCE MATRIX</span>
<span class='co'># parameters of function htsrec(), like type, nn, nn_type, bounds, may be used</span>

<span class='co'># Elementary hierarchy:</span>
<span class='va'>endo_EHd</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>,<span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>,
                  weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Wres</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>,<span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>,
                  const <span class='op'>=</span> <span class='st'>"endo"</span><span class='op'>)</span>

<span class='co'># Level conditional endogenously reconciled forecasts</span>
<span class='co'># L1: Middle-Out reconciled forecasts for the whole hierarchy using Level 1</span>
<span class='co'># L2: Middle-Out reconciled forecasts for the whole hierarchy using Level 2</span>
<span class='co'># L3: Bottom-Up reconciled forecasts</span>
<span class='va'>endo_LCd</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Wres</span><span class='op'>)</span>,
                  const <span class='op'>=</span> <span class='st'>"endo"</span>, CCC <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># Endogenously Combined Conditional Coherent (CCC) reconciled forecasts</span>
<span class='co'># recf: endogenously CCC reconciled forecasts matrix</span>
<span class='co'># lev: list of reconciled forecasts' matrices</span>
<span class='co'># L1: Middle-Out reconciled forecasts for the whole hierarchy using Level 1</span>
<span class='co'># L2: Middle-Out reconciled forecasts for the whole hierarchy using Level 2</span>
<span class='co'># L3: Bottom-Up reconciled forecasts</span>
<span class='va'>endo_CCCd</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>,
                    weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Wres</span><span class='op'>)</span>, const <span class='op'>=</span> <span class='st'>"endo"</span><span class='op'>)</span>

<span class='co'>## ENDOGENOUS CONSTRAINTS AND FULL COVARIANCE MATRIX</span>
<span class='co'># Simply substitute weights=diag(Wres) with weights=Wres</span>
<span class='va'>endo_EHf</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>,<span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>,
                   weights <span class='op'>=</span> <span class='va'>Wres</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>,<span class='st'>"AA"</span>,<span class='st'>"AB"</span>, <span class='st'>"BA"</span>, <span class='st'>"BB"</span>, <span class='st'>"C"</span><span class='op'>)</span><span class='op'>]</span>,
                   const <span class='op'>=</span> <span class='st'>"endo"</span><span class='op'>)</span>
<span class='va'>endo_LCf</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>,
                   weights <span class='op'>=</span> <span class='va'>Wres</span>, const <span class='op'>=</span> <span class='st'>"endo"</span>, CCC <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>endo_CCCf</span> <span class='op'>&lt;-</span> <span class='fu'>levrec</span><span class='op'>(</span>basef <span class='op'>=</span> <span class='va'>mbase</span><span class='op'>-</span><span class='fl'>40</span>, C <span class='op'>=</span> <span class='va'>C</span>, nk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>,
                   weights <span class='op'>=</span> <span class='va'>Wres</span>, const <span class='op'>=</span> <span class='st'>"endo"</span><span class='op'>)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '05a948dc40379c4ff2eaba6f8d83c86e',
    indexName: 'danigiro',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


