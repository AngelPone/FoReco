<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Heuristic first-temporal-then-cross-sectional cross-temporal forecast reconciliation — tcsrec • FoReco</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Heuristic first-temporal-then-cross-sectional cross-temporal forecast reconciliation — tcsrec" />
<meta property="og:description" content="The cross-temporal forecast reconciliation procedure by
Kourentzes and Athanasopoulos (2019) can be viewed as an ensemble forecasting
procedure which exploits the simple averaging of different forecasts.
First, for each time series the forecasts at any temporal aggregation order are
reconciled using temporal hierarchies (thfrec), then
time-by-time cross-sectional reconciliation is performed (htsrec).
The projection matrices obtained at this step are then averaged and used to
cross-sectionally reconcile the forecasts obtained at step 1, by this way
fulfilling both cross-sectional and temporal constraints." />
<meta property="og:image" content="https://danigiro.github.io/FoReco/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FoReco</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/FoReco_package.html">Using the FoReco package</a>
    </li>
    <li>
      <a href="../articles/accuracy_indices.html">Average relative accuracy indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="far fa far fa-newspaper"></span>
     
    News
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/daniGiro/FoReco">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/FoReco/index.html">
    <span class="fab fa fab fa-r-project fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Heuristic first-temporal-then-cross-sectional cross-temporal forecast reconciliation</h1>
    <small class="dont-index">Source: <a href='https://github.com/daniGiro/FoReco/blob/master/R/tcsrec.R'><code>R/tcsrec.R</code></a></small>
    <div class="hidden name"><code>tcsrec.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The cross-temporal forecast reconciliation procedure by
Kourentzes and Athanasopoulos (2019) can be viewed as an ensemble forecasting
procedure which exploits the simple averaging of different forecasts.
First, for each time series the forecasts at any temporal aggregation order are
reconciled using temporal hierarchies (<code><a href='thfrec.html'>thfrec</a></code>), then
time-by-time cross-sectional reconciliation is performed (<code><a href='htsrec.html'>htsrec</a></code>).
The projection matrices obtained at this step are then averaged and used to
cross-sectionally reconcile the forecasts obtained at step 1, by this way
fulfilling both cross-sectional and temporal constraints.</p>
    </div>

    <pre class="usage"><span class='fu'>tcsrec</span>(<span class='no'>basef</span>, <span class='no'>m</span>, <span class='no'>C</span>, <span class='no'>thf_comb</span>, <span class='no'>hts_comb</span>, <span class='no'>Ut</span>, <span class='no'>nb</span>, <span class='no'>res</span>, <span class='no'>W</span>, <span class='no'>Omega</span>,
       <span class='kw'>mse</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>corpcor</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>avg</span><span class='kw'>=</span><span class='st'>"KA"</span>, <span class='kw'>nn</span><span class='kw'>=</span> <span class='fl'>FALSE</span>,
       <span class='kw'>settings</span> <span class='kw'>=</span> <span class='fu'>osqpSettings</span>(<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>eps_abs</span> <span class='kw'>=</span> <span class='fl'>1e-5</span>,
       <span class='kw'>eps_rel</span> <span class='kw'>=</span> <span class='fl'>1e-5</span>, <span class='kw'>polish_refine_iter</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>polish</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>basef</th>
      <td><p>(<code>n x h(k* + m)</code>) matrix of base forecasts to be reconciled;
<code>n</code> is the total number of variables, <code>m</code> is the highest frequency,
<code>k*</code> is the sum of (<code>p-1</code>) factors of <code>m</code>, excluding <code>m</code>,
and <code>h</code> is the forecast horizon. Each row identifies, a time series, and the forecasts
are ordered as [lowest_freq' ...  highest_freq']'.</p></td>
    </tr>
    <tr>
      <th>m</th>
      <td><p>Highest available sampling frequency per seasonal cycle (max. order of temporal aggregation).</p></td>
    </tr>
    <tr>
      <th>C</th>
      <td><p>(<code>na x nb</code>) cross-sectional (contemporaneous) matrix mapping the bottom
level series into the higher level ones.</p></td>
    </tr>
    <tr>
      <th>thf_comb</th>
      <td><p>Type of the (<code>(k* + m) x (k* + m)</code>) covariance matrix to be used in
the temporal reconciliation, see more in <code>comb</code> param of <code><a href='thfrec.html'>thfrec</a></code>.</p></td>
    </tr>
    <tr>
      <th>hts_comb</th>
      <td><p>Type of the (<code>n x n</code>) covariance matrix to be used in the
cross-sectional reconciliation, see more in <code>comb</code> param of <code><a href='htsrec.html'>htsrec</a></code>.</p></td>
    </tr>
    <tr>
      <th>Ut</th>
      <td><p>Zero constraints cross-sectional (contemporaneous) kernel matrix
\(\textbf{U}'\textbf{Y} = \mathbf{0}\) spanning the null space valid for the reconciled
forecasts. It can be used instead of parameter <code>C</code>, but needs <code>nb</code> (n = na + nb). If
the hierarchy admits a structural representation, <code>Ut</code> has dimension (<code>na x n</code>).</p></td>
    </tr>
    <tr>
      <th>nb</th>
      <td><p>Number of bottom time series; if <code>C</code> is present, <code>nb</code> is not used.</p></td>
    </tr>
    <tr>
      <th>res</th>
      <td><p>(<code>n x N(k* + m)</code>) matrix containing the residuals at all the
temporal frequencies ordered [lowest_freq' ...  highest_freq']' (columns) for
each variable (row), needed to estimate the covariance matrix when <code>hts_comb =</code>
<code>{"wls",</code> <code>"shr",</code> <code>"sam"}</code> and/or <code>hts_comb =</code> <code>{"wlsv",</code>
<code>"wlsh",</code> <code>"acov",</code> <code>"strar1",</code> <code>"sar1",</code> <code>"har1",</code>
<code>"shr",</code> <code>"sam"}</code>. The row must be in the same order as <code>basef</code>.</p></td>
    </tr>
    <tr>
      <th>W</th>
      <td><p>This option permits to directly enter the covariance matrix in the
cross-sectional reconciliation, see more in <code>W</code> param of <code><a href='htsrec.html'>htsrec</a></code>.</p></td>
    </tr>
    <tr>
      <th>Omega</th>
      <td><p>This option permits to directly enter the covariance matrix in the
reconciliation through temporal hierarchies, see more in <code>Omega</code> param of <code><a href='thfrec.html'>thfrec</a></code>.</p></td>
    </tr>
    <tr>
      <th>mse</th>
      <td><p>Logical value: <code>TRUE</code> (<em>default</em>) calculates the
covariance matrix of the in-sample residuals (when necessary) according to the original
<span class="pkg">hts</span> and <span class="pkg">thief</span> formulation: no mean correction, T as denominator.</p></td>
    </tr>
    <tr>
      <th>corpcor</th>
      <td><p>Logical value: <code>TRUE</code> if <span class="pkg">corpcor</span> (Schäfer et
al., 2017) must be used to shrink the sample covariance matrix according to
Schäfer and Strimmer (2005), otherwise the function uses the same
implementation as package <span class="pkg">hts</span>.</p></td>
    </tr>
    <tr>
      <th>avg</th>
      <td><p>If <code>avg = "KA"</code> (<em>default</em>), the final projection matrix <code>M</code> is the one proposed
by Kourentzes and Athanasopoulos (2019), otherwise it is calculated as simple average of
all the involved projection matrices at step 2 of th procedure (see Di Fonzo and
Girolimetto, 2020).</p></td>
    </tr>
    <tr>
      <th>nn</th>
      <td><p>Logical value, <code>TRUE</code> if non-negative reconciled forecasts are wished. <strong>Warning</strong>,
the two-step heuristic reconciliation allows non negativity constraints only in the first step.
This means that non-negativity is not guaranteed in the final reconciled values.</p></td>
    </tr>
    <tr>
      <th>settings</th>
      <td><p>Settings for <span class="pkg">osqp</span> (object <code><a href='https://rdrr.io/pkg/osqp/man/osqpSettings.html'>osqpSettings</a></code>). The default options
are: <code>verbose = FALSE</code>, <code>eps_abs = 1e-5</code>, <code>eps_rel = 1e-5</code>,
<code>polish_refine_iter = 100</code> and <code>polish = TRUE</code>. For details, see the
<a href='https://osqp.org/'><span class="pkg">osqp</span> documentation</a> (Stellato et al., 2019).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns a list with two elements:</p>
<dt><code>recf</code></dt><dd><p>(<code>n x h(k* + m)</code>) reconciled forecasts matrix.</p></dd>
<dt><code>M</code></dt><dd><p>Projection matrix (projection approach).</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function performs a two-step cross-temporal forecast reconciliation using
the covariance matrices chosen by the user. If the combinations used by Kourentzes and Athanasopoulos (2019) are
wished, <code>thf_comb</code> must be set equal to either <code>"struc"</code> or <code>"wlsv"</code>,
and <code>hts_comb</code> equal to either <code>"shr"</code> or <code>"wls"</code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Di Fonzo, T., Girolimetto, D. (2020), Cross-Temporal Forecast Reconciliation:
Optimal Combination Method and Heuristic Alternatives, Department of Statistical
Sciences, University of Padua, <a href='https://arxiv.org/abs/2006.08570'>arXiv:2006.08570</a>.</p>
<p>Kourentzes, N., Athanasopoulos, G. (2019), Cross-temporal coherent forecasts
for Australian tourism, <em>Annals of Tourism Research</em>, 75, 393-409.</p>
<p>Schäfer, J.L., Opgen-Rhein, R., Zuber, V., Ahdesmaki, M.,
Duarte Silva, A.P., Strimmer, K. (2017), <em>Package `corpcor'</em>, R
package version 1.6.9 (April 1, 2017), <a href='https://CRAN.R-project.org/package=corpcor'>https://CRAN.R-project.org/package= corpcor</a>.</p>
<p>Schäfer, J.L., Strimmer, K. (2005), A Shrinkage Approach to Large-Scale Covariance
Matrix Estimation and Implications for Functional Genomics, <em>Statistical
Applications in Genetics and Molecular Biology</em>, 4, 1.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Bemporad, A., Boyd, S. (2018). OSQP:
An Operator Splitting Solver for Quadratic Programs, <a href='https://arxiv.org/abs/1711.08013'>arXiv:1711.08013</a>.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Boyd, S., Anderson, E. (2019), OSQP:
Quadratic Programming Solver using the 'OSQP' Library, R package version 0.6.0.3
(October 10, 2019), <a href='https://CRAN.R-project.org/package=osqp'>https://CRAN.R-project.org/package=osqp</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>FoReco_data</span>)
<span class='no'>obj</span> <span class='kw'>&lt;-</span> <span class='fu'>tcsrec</span>(<span class='no'>FoReco_data</span>$<span class='no'>base</span>, <span class='kw'>m</span> <span class='kw'>=</span> <span class='fl'>12</span>, <span class='kw'>C</span> <span class='kw'>=</span> <span class='no'>FoReco_data</span>$<span class='no'>C</span>, <span class='kw'>thf_comb</span> <span class='kw'>=</span> <span class='st'>"acov"</span>,
              <span class='kw'>hts_comb</span> <span class='kw'>=</span> <span class='st'>"shr"</span>, <span class='kw'>res</span> <span class='kw'>=</span> <span class='no'>FoReco_data</span>$<span class='no'>res</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


